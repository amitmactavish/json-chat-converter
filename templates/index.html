<!DOCTYPE html>
<html>
<head>
  <title>Chat JSON Viewer</title>
  <style>
    body { font-family: Arial; margin: 2em; background: #f9f9f9; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    #loader { display: none; font-weight: bold; color: green; }
  </style>
  <script>
    function showLoader() {
      document.getElementById('loader').style.display = 'block';
    }
  </script>
</head>
<body>
<center>
<h2>Upload Skype JSON Chat File</h2>
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul style="color: red;">
      {% for msg in messages %}
        <li>{{ msg }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<form method="POST" enctype="multipart/form-data" onsubmit="showLoader()">
  <input type="file" name="json_file" accept=".json" required>
  <button type="submit">Upload</button>
</form>

<div id="loader">Processing, please wait...</div>

{% if messages %}
<h3>Chat Messages</h3>
<table>
  <tr><th>Timestamp</th><th>Sender</th><th>Message</th></tr>
  {% for msg in messages %}
  <tr>
    <td>{{ msg.timestamp }}</td>
    <td>{{ msg.sender }}</td>
    <td>{{ msg.text }}</td>
  </tr>
  {% endfor %}
</table>

<p>
  <a href="{{ url_for('download', filetype='txt') }}">Download TXT</a> |
  <a href="{{ url_for('download', filetype='csv') }}">Download CSV</a>
</p>
{% endif %}
</center>
</body>
</html>
